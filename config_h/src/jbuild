;; config.h is created atomically by discover.sh to avoid a problem where gcc -MM on some
;; file that includes config.h reads a partial written file, and fails
(rule
 ((targets (config.h rt-flags))
  (deps    (../discover/discover.exe thread_id.h))
  (action  (run ${<} -portable-int63 !${lib-available:base-native-int63}))))


(install
 ((section lib)
  (files
   ((config.h as config_h/config.h)
    (thread_id.h as config_h/thread_id.h)
    (rt-flags as config_h/rt-flags)))))

(library
 ((name config_h)
  (public_name core_kernel.config_h)
  (preprocess (pps (ppx_jane ppxlib.runner)))))

(jbuild_version 1)
